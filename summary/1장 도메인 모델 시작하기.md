# 1장: 도메인 모델 시작하기

### 1. 도메인이란?

- 도메인 주도 개발을 시작하기 전 ‘도메인’이 무엇을 의미하는지 이해해야 한다.
    - 저자는 온라인 서점을 예로 든다. 책을 판매할 때 필요한 상품 조회, 구매, 배송, 결제, 배송 추적 등의 기능등이 필요하다.
    - 이 때 온라인 서점은 우리가 소프트웨어로 구현해내야 하는 대상이며, 우린 도서를 판매하기 위한 기능들을 구현하게 된다. 이렇듯 특정 대상에 대해서 소프트웨어로 해결+구현하는 문제 영역이 존재하는데 이를 **도메인**이라고 부른다.
- 도메인은 하나로만 이뤄지지 않는다.
    - 구매 가능한 상품의 목록을 보여주는 카탈로그 도메인, 주문을 처리하는 주문 도메인, 쿠폰이나 할인을 처리하는 혜택 도메인 등 온라인 서점 도메인 내에 수많은 하위 도메인들이 존재한다.
    - 이러한 도메인들을 모두 개발자가 직접 구현하진 않는다. 서드 파이 라이브러리 혹은 외부 솔루션을 사용해서 처리하기도 한다.

---

### 2. 도메인 전문가와 개발자 간 지식 공유

- 요구사항을 이해하고 같은 언어를 사용하는 것은 매우 중요하다.
    - 코드는 비즈니스를 지탱하는 또 다른 구현 중 하나다. 따라서 비즈니스에서 필요한 요구사항을 먼저 이해하는 것이 중요하다.
    - 만약 통일되지 않은 언어와 이해를 토대로 구현을 시작하면 많은 비용이 낭비된다. 이 때 발생하는 비용은 스타트업의 경우 사업의 흥망에 직접적으로 영향을 주기도 한다.
    - 따라서 개발자와 현업 비즈니스 관계자들도 도메인 지식을 반드시 갖춰야 한다. 같은 지식을 공유하고 서로의 컨텍스트를 일치시킬수록 요구사항이 명확하고 의미있게 도출될 가능성이 높다.
- 요구사항은 다양한 이해관계자로부터 도출된다. 이 때 도메인 지식에 능숙하다고 반드시 적절한 요구사항이 나오는 것은 아니다.
    - 적절하다고 가정해도 올바르게 표현되는 가는 또 다른 문제다.
    - 이 경우 도메인 전문가, 개발자, 이해관계자가 모두 모여 대화를 통해 요구사항을 검증하고 진짜 원하는 것이 무엇인지 발견해야 한다.

---

### 3. 도메인 모델

> *도메인 모델은 기본적으로 도메인 자체를 이해하기 위한 개념 모델이다.*
> 
- 도메인 모델은 개념적인 모델이다. 즉 도메인 모델과 코드는 1:1 치환 관계가 아니다. 해당 모델을 어떻게 구현할 것 인지는 다른 영역의 문제다.

---

### 4. 도메인 모델 패턴

- 여기서 이야기하는 도메인 모델 패턴은 마틴 파울러의 ‘엔터프라이즈 애플리케이션 아키텍쳐 패턴’에서 발췌한 내용이다. 개념 상으로 표현한 도메인 모델을 객체 지향 기법으로 구현한다.
    - 사용자 인터페이스(UI, Presentation) 영역
        - 클라이언트의 요청을 처리하고 정보를 보여준다. 클라이언트는 프로덕트를 이용하는 고객일 수 도, 외부 서드 파티 시스템일 수 도 있다.
    - 응용(Application) 영역
        - 클라이언트가 요청한 기능을 실행한다. 이 때 실행되는 기능은 도메인 영역에 구현된 객체들을 통해 수행되며, 응용 영역은 비즈니스 로직을 표현하지 않는다.
    - 도메인(Domain) 영역
        - 클라이언트에게 시스템이 제공할 도메인 규칙을 구현한다.
    - 인프라스트럭처(Infrastructure) 영역
        - 데이터베이스, 파일 시스템, 문자 메시지 모듈 등 외부 시스템 연동을 처리한다.

---

### 6. 엔티티와 밸류

- 앞 5장에선 코드를 통해 주문 도메인을 어떻게 구현하는지 살펴보았다. 여기서 사용했던 개념 중 엔티티와 밸류의 차이를 알아본다.
- 엔티티는 식별자를 가지는 객체다. 식별자는 각자 고유한 값을 통해 구별될 수 있음을 뜻한다. 주문 도메인에선 어떤 형식을 가지는 주문번호가 될 것이다.
    - 트위터는 [****Announcing Snowflake (트위터의 채번 방식)****](https://www.notion.so/Announcing-Snowflake-04efe5d006294027b929632c6ed35371) 을 사용해 식별자를 지정한다.
    - 대한민국에서 거주하는 경우 주민번호가 발급되는 것과 유사하다. 머리색이 같고 같은 이름을 사용한다고 해서 **같은 사람이라고 표현하지 않는다. ‘**주민번호’ 라는 고유한 식별자를 통해 동일성을 판단한다.
    - 소프트웨어를 구현할 때 컴퓨터에게 ‘같다’라는 개념을 표현하는 것은 굉장히 중요하다.
        - 자바에선 이를 위해 `Object.equals(), hashcode()` 메서드 재정의를 필요로 한다.
- 밸류 타입은 값을 통해 동일성을 판단한다.
    - 100원과 100원은 다른가? 물론 동전의 발행년도와 낡음의 정도에 따라 다를수도 있다. 하지만 우린 일반적으로 2개의 100원 동전은 **같은 100원 동전으로 표현**한다.
    - 주문 도메인에서도 마찬가지다. 내부적으로 100이라는 정수형 값을 갖는 Money 객체는 식별자가 존재하지 않으며 **같은 값을 가지면 같다고 표현**된다.
- 밸류 객체는 멀티스레드 안정성을 위해 불변으로 구현하는 것이 좋다. 만약 값이 달라지는 경우 내부 필드를 수정하지 않고 새로운 객체를 생성하는 것을 권장한다.
- 도메인 모델엔 `set*` 메서드를 넣지 말자

---

### 7. 도메인 용어와 유비쿼터스 언어

> *에릭 에반스는 도메인 주도 설계에서 언어의 중요함을 강조하기 위해 **유비쿼터스 언어(Ubiquitous language)라는 용어를 사용**했다. 전문가, 관계자, 개발자가 도메인과 관련된 **공통의 언어를 만들고** 이를 대화, 문서, 도메인 모델, 코드 테스트 등 **모든 곳에서 같은 용어를 사용**한다. 이렇게 하면 **소통 과정에서 발생하는 용어의 모호함을 줄일 수 있고** **개발자는 도메인과 코드 사이에서 불필요한 해석 과정을 줄일 수 있다.***
> 
- 코드를 작성할 때 도메인 모델에 사용되는 언어는 비즈니스 도메인에서도 사용되는 언어여야 한다.