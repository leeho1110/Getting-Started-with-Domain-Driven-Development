# 2장: 아키텍쳐 개요

### 2. 계층 구조 아키텍쳐

- 계층 구조를 엄격하게 적용하는 경우 바로 아래 계층에 대해서만 의존성을 띄어야 한다. 하지만 일반적으로 응용 계층이 필요없는 경우 인프라스트럭처 계층을 표현 계층에서 직접 의존하기도 한다.
- 위 의존성 때문에 테스트와 기능 확장이 어렵다는 문제가 발생한다. 따라서 이를 DIP로 해결한다.

---

### 3. DIP

- DIP는 [SOLID Foundation - 백명석님 ‘클린 코더스’ 세미나](https://www.notion.so/SOLID-Foundation-231393c388c84d3d9d236b99d601fbbb) 에서 언급된 객체지향 원칙 5가지 중 하나다. 핵심은 간단하다. 시스템을 구현할 때  고수준 모듈의 기능 구현을 위해 하위 수준 모듈이 필요하다.
    - 이는 고수준 모듈이 하위 수준 모듈에게 의존성을 가짐을 의미하는데, DIP를 통해 **저수준 모듈이 고수준 모듈에 의존하도록 의존성을 역전**시키는 것이 핵심이다.
    - 자바에서는 이를 추상화 인터페이스를 통해 가능케 한다.
- 일반적으로 인프라스트럭쳐 영역은 구현 기술을 다루는 하위 수준 모듈, 응용 영역과 도메인 영역은 고수준 모듈이다.

---

### 4. 도메인 영역의 주요 구성 요소

- 도메인 영역의 주요 구성 요소는 총 5가지 입니다.
    - 엔티티(Entity): 고유 식별자를 갖는 객체입니다. 자신만의 라이프 사이클을 가지며, 도메인의 고유 개념을 표현하기 위해 사용됩니다. 도메인 모델의 데이터를 포함하며 관련 데이터를 핸들링하는 기능을 제공하는 객체입니다.
    - 밸류(Value): 엔티티와는 다르게 고유 식별자를 갖지 않습니다. 이는 식별할 필요가 없다는 의미도 됩니다. 따라서 개념적으로 하나인 값을 표현할 때 사용됩니다. 주소, 금액과 같은 타입이 그 예시입니다.
    - 애그리거트(Aggregate): 서로 연관된 엔티티와 밸류 객체를 개념적으로 묶은 것을 의미합니다. 주문 도메인이라면 Order(Entity), OrderLine(Value), Orderer(Value)를 묶을 수 있습니다.
    - 리포지터리(Repository): 도메인 모델의 영속성을 처리합니다. 일반적으로 웹 서버는 Stateless하게 동작합니다. 이 때 추가적으로 필요한 상태(State)는 일반적으로 데이터베이스에 저장합니다. 저장된 데이터베이스에서 엔티티 객체들을 가져오고 저장하는 역할을 수행합니다.
    - 도메인 서비스(Domain Service): 특정 엔티티에 속하지 않은 도메인 로직을 제공합니다. 본문의 예시로는 ‘할인 금액 계산’을 진행할 땐 상품, 쿠폰, 회원 등 다양한 조건과 도메인 모델이 필요합니다. 이런 경우 특정 도메인 엔티티가 아닌 도메인 서비스를 통해 로직을 구현합니다.
- 도메인이 거대해지면 자연스럽게 엔티티와 밸류의 갯수도 늘어납니다. 즉 도메인 모델 내 복잡성이 증가하게 됩니다. 이 때 도메인 모델에서 좀 더 멀리 떨어져서 숲의 관점을 표현하는 수단이 바로 애그리거트다. 이를 통해 전체 모델들과 개별 모델간의 관계를 이해하는데에 도움이 된다.
- 애그리거트는 내부의 **도메인 객체들을 관리하는 루트 엔티티**를 갖습니다. 루트 엔티티는 애그리거트가 구현하는 기능을 엔티티와 밸류를 적절하게 활용해 제공한다.
    - 애그리거트에서는 루트 엔티티를 제외하고는 엔티티 내의 밸류들을 변경할 수 있는 방법을 제공하진 않습니다.

---

### 5. 요청 처리 흐름

- 사용자가 웹 브라우저를 통해 애플리케이션 기능을 요청하는 경우, 일반적으로 표현 → 응용 → 도메인 모델 및 리포지터리 순서로 프로세스가 처리됩니다.
    - 표현 계층에선 사용자가 전송한 요청을 검증하며, 데이터 형식에 대한 검사가 일반적입니다.
    - 응용 계층에서는 표현 계층에서 검증된 요청을 활용해 도메인 모델과 함께 기능을 실행합니다.
        - 기능을 실행할 때 데이터베이스에 저장된 특정 값이 필요하거나, 기능 실행 후 저장이 필요할 경우 리포지터리까지 같이 활용합니다.

---