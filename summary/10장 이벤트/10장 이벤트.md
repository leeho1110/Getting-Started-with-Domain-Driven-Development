# 10장: 이벤트

### 1. 시스템 간 강결합 문제

- 쇼핑몰에서 구매를 취소하고 환불을 진행하는 프로세스를 예로 들어보자.
    - 환불 기능은 주문 도메인 엔티티가 처리해도 크게 이상하지 않다.
    - 따라서 환불 기능을 제공하는 도메인 서비스를 파라미터 혹은 인스턴스 필드로 전달받아 해당 도메인 서비스를 실행하면 환불 절차가 완료된다.
        - 환불은 내부 절차 외에 외부 PG사에게도 요청을 전송해야 한다.
    - 그렇다면 여기서 외부 PG사가 정상적이지 않다면 내부 절차는 어떻게 처리해야할까? **외부 결제 시스템 연동과 내부 로직을 하나의 트랜잭션**으로 묶어야 하는 걸까?
        - 만약 내부 시스템 예외라면 트랜잭션을 롤백하는 것이 맞지만 내부는 정상적으로 처리되고 외부 시스템과의 연동만 실패한다면, 내부 트랜잭션은 커밋하고 외부 시스템은 추후 재요청하는 방식으로 처리할수도 있지 않을까?
    - 외부 시스템의 응답이 늦는다면 응답 대기 시간동안 주문 취소 기능은 응답이 완료될 때까지 대기해야 한다. 이는 애플리케이션이 **외부 시스템 성능에 영향을 받는다는 것**을 의미한다.
    - 또한 ‘주문 취소’ 기능은 `Order`, `OrderService` 같은 도메인 서비스 혹은 도메인 객체에 구현될텐데 환불에 관련된 기능까지 섞여버리는 문제도 생긴다.
        - 만약 환불 이후 고객에게 통지까지 해야된다면? 점점 더 복잡해지고 트랜잭션 처리도 어려워진다. 심지어 이 경우 처리가 완료될 때까지 필요한 외부 시스템까지 2개로 늘어난다.
- 위에서 생기는 문제의 근본적인 원인은 바로 **주문 바운디드 컨텍스트와 결제 바운디드 컨텍스트의 강결합**이다.
    - 이런 강결합을 제거하기 위한 방법이 바로 (비동기) 이벤트다.

---